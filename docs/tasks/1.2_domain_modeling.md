# 1.2. Domain Modeling (`internal/core`)

**Goal**: Define the core business entities (`Task`, `Config`) using idiomatic Go. We will use **Strict Types** (Value Objects) over raw strings where possible to enforce validity.

## 1. References & Context
*   **PRD**: [Task Schema](../PRD.md#42-task-schema) & [Config Schema](../PRD.md#43-configuration-schema)
*   **Libraries**:
    *   [adrg/frontmatter](https://github.com/adrg/frontmatter): Used for parsing Markdown frontmatter. Uses standard `yaml` tags.
*   **Concepts**:
    *   **Value Objects**: Use `type Status string` instead of `string`.
    *   **YAML Tags**: Use `yaml:"field,omitempty"` to control serialization.

## 2. Detailed Steps

### A. Task Domain (`internal/core/task.go`)
Define the `Task` entity. Use strict types for Enums to prevent invalid states.

```go
package core

import "time"

// Value Objects
type TaskID string
type Status string
type Priority string

const (
    StatusBacklog Status = "backlog"
    StatusTodo    Status = "todo"
    StatusDoing   Status = "doing"
    StatusDone    Status = "done"
)

const (
    PriorityLow    Priority = "low"
    PriorityMedium Priority = "medium"
    PriorityHigh   Priority = "high"
)

// Task represents the file on disk.
type Task struct {
    // Frontmatter Fields
    ID       TaskID   `yaml:"id"`
    Title    string   `yaml:"title"`
    Status   Status   `yaml:"status"`
    Assignee string   `yaml:"assignee,omitempty"`
    Priority Priority `yaml:"priority,omitempty"`
    Tags     []string `yaml:"tags,omitempty"`
    Created  string   `yaml:"created"` // Keep as string for simple IO, parse later if needed
    
    // Internal Fields (Excluded from YAML)
    Body     string   `yaml:"-"`
    FilePath string   `yaml:"-"`
}
```

### B. Configuration Domain (`internal/core/config.go`)
Define the Project and Agent configuration.

```go
package core

type ProjectConfig struct {
    Project ProjectMeta   `yaml:"project"`
    Agents  []AgentConfig `yaml:"agents"`
}

type ProjectMeta struct {
    Name    string `yaml:"name"`
    Version string `yaml:"version,omitempty"`
}

type AgentConfig struct {
    Name         string   `yaml:"name"`
    Description  string   `yaml:"description,omitempty"`
    Executor     string   `yaml:"executor"` // "docker" or "local"
    Image        string   `yaml:"image,omitempty"`
    Command      []string `yaml:"command"`  // ["opencode", "--task", "{{.TaskPath}}"]
    EnvPass      []string `yaml:"env_pass,omitempty"`
    SystemPrompt string   `yaml:"system_prompt,omitempty"`
}
```

## 3. Success Criteria
- [ ] `internal/core` package created.
- [ ] `Task` struct defined with strict `Status` and `Priority` types.
- [ ] `ProjectConfig` struct defined matching `config.yaml` spec.
- [ ] Struct tags (`yaml`) are correctly applied.
- [ ] Code compiles without external dependencies (Core should be pure).
